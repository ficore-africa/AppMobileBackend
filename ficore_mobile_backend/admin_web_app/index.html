<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"><title>FiCore Admin Dashboard</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"><link rel="stylesheet" href="responsive.css"><style>:root {--primary-color: #B88A44;--secondary-color: #917243;--success-color: #10B981;--warning-color: #F59E0B;--danger-color: #EF4444;}.navbar-brand {color: var(--primary-color) !important;font-weight: bold;}.btn-primary {background-color: var(--primary-color);border-color: var(--primary-color);}.btn-primary:hover {background-color: var(--secondary-color);border-color: var(--secondary-color);}.card-header {background-color: var(--primary-color);color: white;}.status-pending {background-color: var(--warning-color);color: white;padding: 4px 8px;border-radius: 4px;font-size: 0.8em;}.status-approved {background-color: var(--success-color);color: white;padding: 4px 8px;border-radius: 4px;font-size: 0.8em;}.status-rejected {background-color: var(--danger-color);color: white;padding: 4px 8px;border-radius: 4px;font-size: 0.8em;}.login-container {min-height: 100vh;display: flex;align-items: center;justify-content: center;background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));}.login-card {max-width: 400px;width: 100%;}#loginError {min-height: 40px;}</style></head><body><!-- Login Screen --><div id="loginScreen" class="login-container"><div class="card login-card"><div class="card-header text-center"><h4><i class="fas fa-shield-alt"></i> FiCore Admin Login</h4></div><div class="card-body"><form id="loginForm"><div class="mb-3"><label for="email" class="form-label">Admin Email</label><input type="email" class="form-control" id="email" value="admin@ficore.com" required></div><div class="mb-3"><label for="password" class="form-label">Password</label><input type="password" class="form-control" id="password" value="admin123" required></div><button type="submit" class="btn btn-primary w-100"><i class="fas fa-sign-in-alt"></i> Login</button></form><div id="loginError" class="alert alert-danger mt-3" style="display: none;"></div><!-- API Configuration --><div class="mt-3"><h6>API Configuration:</h6><div class="input-group input-group-sm"><span class="input-group-text">Backend URL</span><input type="text" class="form-control" id="customApiUrl"placeholder="https://your-backend.render.com"><button class="btn btn-outline-secondary" type="button" onclick="updateApiUrl()">Update</button></div><small class="text-muted">Current API: <span id="apiUrl">Loading...</span></small></div></div></div></div><!-- Main Dashboard --><div id="dashboardScreen" style="display: none;"><!-- Navigation --><nav class="navbar navbar-expand-lg navbar-light bg-light"><div class="container-fluid"><a class="navbar-brand" href="#"><i class="fas fa-coins"></i> FiCore Admin</a><div class="navbar-nav ms-auto"><span class="navbar-text me-3">Welcome, <span id="adminName">Admin</span></span><button class="btn btn-outline-danger btn-sm" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button></div></div></nav><div class="container-fluid mt-4"><!-- Timeframe Selector --><div class="row mb-3"><div class="col-md-12"><div class="card"><div class="card-body"><div class="row align-items-center"><div class="col-md-6"><label class="form-label mb-0"><strong>Activity Timeframe:</strong></label><select id="timeframeSelector" class="form-select form-select-sm d-inline-block w-auto ms-2" onchange="updateTimeframe()"><option value="7">Last 7 days</option><option value="30" selected>Last 30 days</option><option value="60">Last 60 days</option><option value="90">Last 90 days</option></select></div><div class="col-md-6 text-end"><button class="btn btn-success btn-sm" onclick="exportUsers('all')"><i class="fas fa-download"></i> Export All Users</button><button class="btn btn-info btn-sm" onclick="exportUsers('active')"><i class="fas fa-download"></i> Export Active</button><button class="btn btn-warning btn-sm" onclick="exportUsers('inactive')"><i class="fas fa-download"></i> Export Inactive</button></div></div></div></div></div></div><!-- Statistics Cards --><div class="row mb-4"><div class="col-md-3"><div class="card text-white bg-primary"><div class="card-body"><div class="d-flex justify-content-between"><div><h4 id="totalUsers">0</h4><p class="mb-0">Total Users</p><small id="newUsersTimeframe" class="text-white-50">0 new</small></div><i class="fas fa-users fa-2x"></i></div></div></div></div><div class="col-md-3"><div class="card text-white" style="background: linear-gradient(135deg, #FFD700, #FFA500); cursor: pointer;" onclick="window.location.href='premium_users.html'"><div class="card-body"><div class="d-flex justify-content-between"><div><h4 id="premiumUsers">0</h4><p class="mb-0">Premium Users</p><small class="text-white-50">Click to manage</small></div><i class="fas fa-crown fa-2x"></i></div></div></div></div><div class="col-md-3"><div class="card text-white bg-success"><div class="card-body"><div class="d-flex justify-content-between"><div><h4 id="activeUsersTimeframe">0</h4><p class="mb-0">Active Users</p><small id="activeUsersLabel" class="text-white-50">Last 30 days</small></div><i class="fas fa-user-check fa-2x"></i></div></div></div></div><div class="col-md-3"><div class="card text-white bg-warning"><div class="card-body"><div class="d-flex justify-content-between"><div><h4 id="pendingRequests">0</h4><p class="mb-0">Pending Requests</p></div><i class="fas fa-clock fa-2x"></i></div></div></div></div></div><!-- Tabs --><ul class="nav nav-tabs" id="adminTabs" role="tablist"><li class="nav-item" role="presentation"><button class="nav-link active" id="requests-tab" data-bs-toggle="tab" data-bs-target="#requests"type="button" role="tab"><i class="fas fa-credit-card"></i> Credit Requests</button></li><li class="nav-item" role="presentation"><a class="nav-link" href="premium_users.html"><i class="fas fa-crown text-warning"></i> Premium Users</a></li><li class="nav-item" role="presentation"><a class="nav-link" href="cancellation_requests.html"><i class="fas fa-ban text-danger"></i> Cancellation Requests</a></li><li class="nav-item" role="presentation"><button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button"role="tab"><i class="fas fa-users"></i> All Users</button></li><li class="nav-item" role="presentation"><button class="nav-link" id="active-users-tab" data-bs-toggle="tab" data-bs-target="#activeUsers" type="button"role="tab" onclick="loadActiveUsers()"><i class="fas fa-user-check"></i> Active Users</button></li><li class="nav-item" role="presentation"><button class="nav-link" id="inactive-users-tab" data-bs-toggle="tab" data-bs-target="#inactiveUsers" type="button"role="tab" onclick="loadInactiveUsers()"><i class="fas fa-user-times"></i> Inactive Users</button></li></ul><div class="tab-content" id="adminTabsContent"><!-- Credit Requests Tab --><div class="tab-pane fade show active" id="requests" role="tabpanel"><div class="card mt-3"><div class="card-header"><h5><i class="fas fa-credit-card"></i> Credit Requests Management</h5></div><div class="card-body"><div class="table-responsive"><table class="table table-striped"><thead><tr><th>Request ID</th><th>User</th><th>Amount</th><th>Payment Method</th><th>Status</th><th>Date</th><th>Actions</th></tr></thead><tbody id="requestsTableBody"><tr><td colspan="7" class="text-center">Loading...</td></tr></tbody></table></div></div></div></div><!-- Users Tab --><div class="tab-pane fade" id="users" role="tabpanel"><div class="card mt-3"><div class="card-header"><h5><i class="fas fa-users"></i> All Users Management</h5></div><div class="card-body"><div class="table-responsive"><table class="table table-striped"><thead><tr><th>Email</th><th>Name</th><th>Credit Balance</th><th>Status</th><th>Last Login</th><th>Joined</th><th>Actions</th></tr></thead><tbody id="usersTableBody"><tr><td colspan="7" class="text-center">Loading...</td></tr></tbody></table></div></div></div></div><!-- Active Users Tab --><div class="tab-pane fade" id="activeUsers" role="tabpanel"><div class="card mt-3"><div class="card-header"><h5><i class="fas fa-user-check"></i> Active Users <span id="activeUsersCount" class="badge bg-success">0</span></h5></div><div class="card-body"><div class="table-responsive"><table class="table table-striped"><thead><tr><th>Email</th><th>Name</th><th>Phone</th><th>Credit Balance</th><th>Subscription</th><th>Last Login</th><th>Days Since Login</th></tr></thead><tbody id="activeUsersTableBody"><tr><td colspan="7" class="text-center">Click to load active users...</td></tr></tbody></table></div></div></div></div><!-- Inactive Users Tab --><div class="tab-pane fade" id="inactiveUsers" role="tabpanel"><div class="card mt-3"><div class="card-header"><h5><i class="fas fa-user-times"></i> Inactive Users <span id="inactiveUsersCount" class="badge bg-danger">0</span></h5></div><div class="card-body"><div class="table-responsive"><table class="table table-striped"><thead><tr><th>Email</th><th>Name</th><th>Phone</th><th>Credit Balance</th><th>Subscription</th><th>Last Login</th><th>Days Inactive</th></tr></thead><tbody id="inactiveUsersTableBody"><tr><td colspan="7" class="text-center">Click to load inactive users...</td></tr></tbody></table></div></div></div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script><script>// Admin Web App JavaScriptlet API_BASE_URL = (() => {const customApiUrl = localStorage.getItem('customApiUrl');if (customApiUrl) {return customApiUrl;}if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {return 'http://localhost:5000';}return window.location.origin;})();console.log('ðŸ”— API Base URL:', API_BASE_URL);let authToken = localStorage.getItem('admin_token');let currentRequestId = null;// Initialize the appdocument.addEventListener('DOMContentLoaded', function () {console.log('DOM loaded, initializing admin app');document.getElementById('apiUrl').textContent = API_BASE_URL;document.getElementById('customApiUrl').value = API_BASE_URL;const savedToken = localStorage.getItem('admin_token');if (savedToken) {console.log('Found saved token, attempting to show dashboard');authToken = savedToken;showDashboard();loadDashboardData();}const loginForm = document.getElementById('loginForm');loginForm.addEventListener('submit', handleLogin);console.log('Login form listener attached');});function updateApiUrl() {const newUrl = document.getElementById('customApiUrl').value.trim();if (newUrl && newUrl !== API_BASE_URL) {localStorage.setItem('customApiUrl', newUrl);API_BASE_URL = newUrl;alert('API URL updated successfully. You can now try logging in.');document.getElementById('apiUrl').textContent = API_BASE_URL;}}async function handleLogin(e) {e.preventDefault();console.log('Login form submitted');const email = document.getElementById('email').value;const password = document.getElementById('password').value;console.log('Login attempt for:', email);try {const response = await fetch(`${API_BASE_URL}/auth/login`, {method: 'POST',headers: {'Content-Type': 'application/json',},body: JSON.stringify({ email, password })});console.log('Login response status:', response.status);const data = await response.json();console.log('Login response data:', data);if (data.success && data.data.user.role === 'admin') {authToken = data.data.token || data.data.access_token;localStorage.setItem('admin_token', authToken);document.getElementById('adminName').textContent = data.data.user.displayName || 'Admin';showDashboard();loadDashboardData();} else if (data.success && data.data.user.role !== 'admin') {showError('Access denied: Admin privileges required');} else {showError(data.message || 'Invalid admin credentials');}} catch (error) {console.error('Login error:', error);if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {showError('Connection failed: Unable to reach the backend server. Please check the API URL.');} else {showError('Login failed: ' + error.message);}}}function showDashboard() {console.log('Showing dashboard');document.getElementById('loginScreen').style.display = 'none';document.getElementById('dashboardScreen').style.display = 'block';}function showLogin() {console.log('Showing login screen');document.getElementById('loginScreen').style.display = 'flex';document.getElementById('dashboardScreen').style.display = 'none';}function showError(message) {console.log('Showing error:', message);const errorDiv = document.getElementById('loginError');errorDiv.textContent = message;errorDiv.style.display = 'block';setTimeout(() => {errorDiv.style.display = 'none';}, 5000);}function logout() {console.log('Logging out');localStorage.removeItem('admin_token');authToken = null;showLogin();}async function loadDashboardData() {console.log('Loading dashboard data');await Promise.all([loadStatistics(),loadCreditRequests(),loadUsers()]);}let currentTimeframe = 30;function updateTimeframe() {currentTimeframe = parseInt(document.getElementById('timeframeSelector').value);loadStatistics();}async function loadStatistics() {try {const statsResponse = await fetch(`${API_BASE_URL}/admin/dashboard/stats?timeframe=${currentTimeframe}`, {headers: { 'Authorization': `Bearer ${authToken}` }});const statsData = await statsResponse.json();console.log('Dashboard stats response:', statsData);const requestsResponse = await fetch(`${API_BASE_URL}/admin/credit-requests`, {headers: { 'Authorization': `Bearer ${authToken}` }});const requestsData = await requestsResponse.json();console.log('Credit requests response:', requestsData);if (statsData.success) {const stats = statsData.data;document.getElementById('totalUsers').textContent = stats.totalUsers;document.getElementById('activeUsersTimeframe').textContent = stats.activeUsersTimeframe;document.getElementById('newUsersTimeframe').textContent = `${stats.newUsersTimeframe} new`;document.getElementById('activeUsersLabel').textContent = `Last ${stats.timeframeDays} days`;}// Load premium users countloadPremiumUsersCount();if (requestsData.success) {const stats = requestsData.data.statistics;document.getElementById('pendingRequests').textContent = stats.pending;}} catch (error) {console.error('Failed to load statistics:', error);}}async function exportUsers(status) {try {const url = `${API_BASE_URL}/admin/users/export?status=${status}&timeframe=${currentTimeframe}`;const response = await fetch(url, {headers: { 'Authorization': `Bearer ${authToken}` }});if (response.ok) {const blob = await response.blob();const downloadUrl = window.URL.createObjectURL(blob);const a = document.createElement('a');a.href = downloadUrl;a.download = `ficore_users_${status}_${new Date().toISOString().split('T')[0]}.csv`;document.body.appendChild(a);a.click();a.remove();window.URL.revokeObjectURL(downloadUrl);showSuccessMessage(`Users exported successfully!`);} else {alert('Failed to export users');}} catch (error) {console.error('Export error:', error);alert('Failed to export users: ' + error.message);}}async function loadActiveUsers() {try {const response = await fetch(`${API_BASE_URL}/admin/users/list/active?timeframe=${currentTimeframe}&limit=100`, {headers: { 'Authorization': `Bearer ${authToken}` }});const data = await response.json();console.log('Active users response:', data);if (data.success) {displayActiveUsers(data.data.users);document.getElementById('activeUsersCount').textContent = data.data.pagination.total;}} catch (error) {console.error('Failed to load active users:', error);document.getElementById('activeUsersTableBody').innerHTML ='<tr><td colspan="7" class="text-center text-danger">Failed to load active users</td></tr>';}}function displayActiveUsers(users) {const tbody = document.getElementById('activeUsersTableBody');if (users.length === 0) {tbody.innerHTML = '<tr><td colspan="7" class="text-center">No active users found</td></tr>';return;}tbody.innerHTML = users.map(user => `<tr><td>${user.email}</td><td>${user.displayName || 'Not set'}</td><td>${user.phone || 'N/A'}</td><td>${user.ficoreCreditBalance.toLocaleString()} FCs</td><td>${user.isSubscribed ? `<span class="badge bg-success">${user.subscriptionType || 'Premium'}</span>` : '<span class="badge bg-secondary">Free</span>'}</td><td>${new Date(user.lastLogin).toLocaleDateString()}</td><td>${user.daysSinceLastLogin} days</td></tr>`).join('');}async function loadInactiveUsers() {try {const response = await fetch(`${API_BASE_URL}/admin/users/list/inactive?timeframe=${currentTimeframe}&limit=100`, {headers: { 'Authorization': `Bearer ${authToken}` }});const data = await response.json();console.log('Inactive users response:', data);if (data.success) {displayInactiveUsers(data.data.users);document.getElementById('inactiveUsersCount').textContent = data.data.pagination.total;}} catch (error) {console.error('Failed to load inactive users:', error);document.getElementById('inactiveUsersTableBody').innerHTML ='<tr><td colspan="7" class="text-center text-danger">Failed to load inactive users</td></tr>';}}function displayInactiveUsers(users) {const tbody = document.getElementById('inactiveUsersTableBody');if (users.length === 0) {tbody.innerHTML = '<tr><td colspan="7" class="text-center">No inactive users found</td></tr>';return;}tbody.innerHTML = users.map(user => `<tr><td>${user.email}</td><td>${user.displayName || 'Not set'}</td><td>${user.phone || 'N/A'}</td><td>${user.ficoreCreditBalance.toLocaleString()} FCs</td><td>${user.isSubscribed ? `<span class="badge bg-success">${user.subscriptionType || 'Premium'}</span>` : '<span class="badge bg-secondary">Free</span>'}</td><td>${user.lastLogin === 'Never' ? '<span class="badge bg-warning">Never</span>' : new Date(user.lastLogin).toLocaleDateString()}</td><td>${user.neverLoggedIn ? '<span class="badge bg-danger">Never logged in</span>' : `${user.daysSinceLastLogin} days`}</td></tr>`).join('');}async function loadCreditRequests() {try {const response = await fetch(`${API_BASE_URL}/admin/credit-requests`, {headers: { 'Authorization': `Bearer ${authToken}` }});const data = await response.json();console.log('Credit requests response:', data);if (data.success) {displayCreditRequests(data.data.requests);}} catch (error) {console.error('Failed to load credit requests:', error);document.getElementById('requestsTableBody').innerHTML ='<tr><td colspan="7" class="text-center text-danger">Failed to load requests</td></tr>';}}function displayCreditRequests(requests) {console.log('Displaying credit requests:', requests);const tbody = document.getElementById('requestsTableBody');if (requests.length === 0) {tbody.innerHTML = '<tr><td colspan="7" class="text-center">No credit requests found</td></tr>';return;}tbody.innerHTML = requests.map(request => `<tr><td>${request.requestId}</td><td><div>${request.user?.displayName || 'Unknown'}</div><small class="text-muted">${request.user?.email || ''}</small></td><td>â‚¦${request.amount.toLocaleString()}</td><td>${request.paymentMethod}</td><td><span class="status-${request.status}">${request.status.toUpperCase()}</span></td><td>${new Date(request.createdAt).toLocaleDateString()}</td><td>${request.status === 'pending' ? `<button class="btn btn-sm btn-primary" onclick="showRequestModal('${request.requestId}', ${JSON.stringify(request).replace(/"/g, '&quot;')})"><i class="fas fa-edit"></i> Process</button>` : `<button class="btn btn-sm btn-outline-secondary" onclick="viewRequestDetails('${request.requestId}')"><i class="fas fa-eye"></i> View</button>`}</td></tr>`).join('');}async function loadUsers() {try {const response = await fetch(`${API_BASE_URL}/admin/users`, {headers: { 'Authorization': `Bearer ${authToken}` }});const data = await response.json();console.log('Users response:', data);if (data.success) {displayUsers(data.data.users);}} catch (error) {console.error('Failed to load users:', error);document.getElementById('usersTableBody').innerHTML ='<tr><td colspan="7" class="text-center text-danger">Failed to load users</td></tr>';}}function displayUsers(users) {console.log('Displaying users:', users);const tbody = document.getElementById('usersTableBody');if (users.length === 0) {tbody.innerHTML = '<tr><td colspan="7" class="text-center">No users found</td></tr>';return;}tbody.innerHTML = users.map(user => `<tr><td>${user.email}</td><td>${user.displayName || 'Not set'}</td><td>${user.ficoreCreditBalance.toLocaleString()} FCs</td><td><span class="badge ${user.isActive ? 'bg-success' : 'bg-danger'}">${user.isActive ? 'Active' : 'Inactive'}</span></td><td>${user.lastLogin ? new Date(user.lastLogin).toLocaleDateString() : '<span class="badge bg-warning">Never</span>'}</td><td>${new Date(user.createdAt).toLocaleDateString()}</td><td><button class="btn btn-sm btn-outline-primary" onclick="adjustUserCredits('${user.id}', '${user.displayName}', ${user.ficoreCreditBalance})"><i class="fas fa-coins"></i> Credits</button></td></tr>`).join('');}async function loadPremiumUsersCount() {try {const response = await fetch(`${API_BASE_URL}/admin/users?limit=1000`, {headers: { 'Authorization': `Bearer ${authToken}` }});const data = await response.json();if (data.success) {const premiumCount = data.data.users.filter(user => user.isSubscribed === true).length;document.getElementById('premiumUsers').textContent = premiumCount;}} catch (error) {console.error('Failed to load premium users count:', error);}}function showSuccessMessage(message) {console.log('Showing success message:', message);const alertDiv = document.createElement('div');alertDiv.className = 'alert alert-success alert-dismissible fade show position-fixed';alertDiv.style.top = '20px';alertDiv.style.right = '20px';alertDiv.style.zIndex = '9999';alertDiv.innerHTML = `${message}<button type="button" class="btn-close" data-bs-dismiss="alert"></button>`;document.body.appendChild(alertDiv);setTimeout(() => {if (alertDiv.parentNode) {alertDiv.parentNode.removeChild(alertDiv);}}, 3000);}</script></body></html>
